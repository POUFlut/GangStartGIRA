import{r as c,j as o,g as ve,u as be,q as z,d as _,o as he,P as w,e as R,n as Ie,R as T,a as M,v as Ne,A as Ce,w as Te,x as Fe,B as V,t as H,y as Se}from"./index-C2Kdumku.js";import{B as Y,S as Ee}from"./switch-DwExulbL.js";import{L as Re}from"./popover-D8Et53wa.js";import"./index-zrxt1YGd.js";function je(e,s=[]){let t=[];function n(u,r){const a=c.createContext(r),l=t.length;t=[...t,r];function m(f){const{scope:p,children:I,...d}=f,N=(p==null?void 0:p[e][l])||a,F=c.useMemo(()=>d,Object.values(d));return o.jsx(N.Provider,{value:F,children:I})}function x(f,p){const I=(p==null?void 0:p[e][l])||a,d=c.useContext(I);if(d)return d;if(r!==void 0)return r;throw new Error(`\`${f}\` must be used within \`${u}\``)}return m.displayName=u+"Provider",[m,x]}const i=()=>{const u=t.map(r=>c.createContext(r));return function(a){const l=(a==null?void 0:a[e])||u;return c.useMemo(()=>({[`__scope${e}`]:{...a,[e]:l}}),[a,l])}};return i.scopeName=e,[n,ye(i,...s)]}function ye(...e){const s=e[0];if(e.length===1)return s;const t=()=>{const n=e.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(u){const r=n.reduce((a,{useScope:l,scopeName:m})=>{const f=l(u)[`__scope${m}`];return{...a,...f}},{});return c.useMemo(()=>({[`__scope${s.scopeName}`]:r}),[r])}};return t.scopeName=s.scopeName,t}function we(e,s=[]){let t=[];function n(u,r){const a=c.createContext(r),l=t.length;t=[...t,r];function m(f){const{scope:p,children:I,...d}=f,N=(p==null?void 0:p[e][l])||a,F=c.useMemo(()=>d,Object.values(d));return o.jsx(N.Provider,{value:F,children:I})}function x(f,p){const I=(p==null?void 0:p[e][l])||a,d=c.useContext(I);if(d)return d;if(r!==void 0)return r;throw new Error(`\`${f}\` must be used within \`${u}\``)}return m.displayName=u+"Provider",[m,x]}const i=()=>{const u=t.map(r=>c.createContext(r));return function(a){const l=(a==null?void 0:a[e])||u;return c.useMemo(()=>({[`__scope${e}`]:{...a,[e]:l}}),[a,l])}};return i.scopeName=e,[n,Pe(i,...s)]}function Pe(...e){const s=e[0];if(e.length===1)return s;const t=()=>{const n=e.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(u){const r=n.reduce((a,{useScope:l,scopeName:m})=>{const f=l(u)[`__scope${m}`];return{...a,...f}},{});return c.useMemo(()=>({[`__scope${s.scopeName}`]:r}),[r])}};return t.scopeName=s.scopeName,t}var D="rovingFocusGroup.onEntryFocus",Ge={bubbles:!1,cancelable:!0},A="RovingFocusGroup",[k,q,_e]=ve(A),[Ae,W]=we(A,[_e]),[Le,Oe]=Ae(A),J=c.forwardRef((e,s)=>o.jsx(k.Provider,{scope:e.__scopeRovingFocusGroup,children:o.jsx(k.Slot,{scope:e.__scopeRovingFocusGroup,children:o.jsx(De,{...e,ref:s})})}));J.displayName=A;var De=c.forwardRef((e,s)=>{const{__scopeRovingFocusGroup:t,orientation:n,loop:i=!1,dir:u,currentTabStopId:r,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:l,onEntryFocus:m,preventScrollOnEntryFocus:x=!1,...f}=e,p=c.useRef(null),I=be(s,p),d=z(u),[N=null,F]=_({prop:r,defaultProp:a,onChange:l}),[C,S]=c.useState(!1),y=he(m),L=q(t),g=c.useRef(!1),[b,h]=c.useState(0);return c.useEffect(()=>{const v=p.current;if(v)return v.addEventListener(D,y),()=>v.removeEventListener(D,y)},[y]),o.jsx(Le,{scope:t,orientation:n,dir:d,loop:i,currentTabStopId:N,onItemFocus:c.useCallback(v=>F(v),[F]),onItemShiftTab:c.useCallback(()=>S(!0),[]),onFocusableItemAdd:c.useCallback(()=>h(v=>v+1),[]),onFocusableItemRemove:c.useCallback(()=>h(v=>v-1),[]),children:o.jsx(w.div,{tabIndex:C||b===0?-1:0,"data-orientation":n,...f,ref:I,style:{outline:"none",...e.style},onMouseDown:R(e.onMouseDown,()=>{g.current=!0}),onFocus:R(e.onFocus,v=>{const fe=!g.current;if(v.target===v.currentTarget&&fe&&!C){const U=new CustomEvent(D,Ge);if(v.currentTarget.dispatchEvent(U),!U.defaultPrevented){const O=L().filter(E=>E.focusable),ge=O.find(E=>E.active),pe=O.find(E=>E.id===N),xe=[ge,pe,...O].filter(Boolean).map(E=>E.ref.current);Z(xe,x)}}g.current=!1}),onBlur:R(e.onBlur,()=>S(!1))})})}),Q="RovingFocusGroupItem",X=c.forwardRef((e,s)=>{const{__scopeRovingFocusGroup:t,focusable:n=!0,active:i=!1,tabStopId:u,...r}=e,a=Ie(),l=u||a,m=Oe(Q,t),x=m.currentTabStopId===l,f=q(t),{onFocusableItemAdd:p,onFocusableItemRemove:I}=m;return c.useEffect(()=>{if(n)return p(),()=>I()},[n,p,I]),o.jsx(k.ItemSlot,{scope:t,id:l,focusable:n,active:i,children:o.jsx(w.span,{tabIndex:x?0:-1,"data-orientation":m.orientation,...r,ref:s,onMouseDown:R(e.onMouseDown,d=>{n?m.onItemFocus(l):d.preventDefault()}),onFocus:R(e.onFocus,()=>m.onItemFocus(l)),onKeyDown:R(e.onKeyDown,d=>{if(d.key==="Tab"&&d.shiftKey){m.onItemShiftTab();return}if(d.target!==d.currentTarget)return;const N=Be(d,m.orientation,m.dir);if(N!==void 0){if(d.metaKey||d.ctrlKey||d.altKey||d.shiftKey)return;d.preventDefault();let C=f().filter(S=>S.focusable).map(S=>S.ref.current);if(N==="last")C.reverse();else if(N==="prev"||N==="next"){N==="prev"&&C.reverse();const S=C.indexOf(d.currentTarget);C=m.loop?$e(C,S+1):C.slice(S+1)}setTimeout(()=>Z(C))}})})})});X.displayName=Q;var ke={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Me(e,s){return s!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function Be(e,s,t){const n=Me(e.key,t);if(!(s==="vertical"&&["ArrowLeft","ArrowRight"].includes(n))&&!(s==="horizontal"&&["ArrowUp","ArrowDown"].includes(n)))return ke[n]}function Z(e,s=!1){const t=document.activeElement;for(const n of e)if(n===t||(n.focus({preventScroll:s}),document.activeElement!==t))return}function $e(e,s){return e.map((t,n)=>e[(s+n)%e.length])}var Ue=J,Ve=X,He="Toggle",B=c.forwardRef((e,s)=>{const{pressed:t,defaultPressed:n=!1,onPressedChange:i,...u}=e,[r=!1,a]=_({prop:t,onChange:i,defaultProp:n});return o.jsx(w.button,{type:"button","aria-pressed":r,"data-state":r?"on":"off","data-disabled":e.disabled?"":void 0,...u,ref:s,onClick:R(e.onClick,()=>{e.disabled||a(!r)})})});B.displayName=He;var ee=B,j="ToggleGroup",[te,et]=je(j,[W]),oe=W(),$=T.forwardRef((e,s)=>{const{type:t,...n}=e;if(t==="single"){const i=n;return o.jsx(Ye,{...i,ref:s})}if(t==="multiple"){const i=n;return o.jsx(Ke,{...i,ref:s})}throw new Error(`Missing prop \`type\` expected on \`${j}\``)});$.displayName=j;var[se,re]=te(j),Ye=T.forwardRef((e,s)=>{const{value:t,defaultValue:n,onValueChange:i=()=>{},...u}=e,[r,a]=_({prop:t,defaultProp:n,onChange:i});return o.jsx(se,{scope:e.__scopeToggleGroup,type:"single",value:r?[r]:[],onItemActivate:a,onItemDeactivate:T.useCallback(()=>a(""),[a]),children:o.jsx(ne,{...u,ref:s})})}),Ke=T.forwardRef((e,s)=>{const{value:t,defaultValue:n,onValueChange:i=()=>{},...u}=e,[r=[],a]=_({prop:t,defaultProp:n,onChange:i}),l=T.useCallback(x=>a((f=[])=>[...f,x]),[a]),m=T.useCallback(x=>a((f=[])=>f.filter(p=>p!==x)),[a]);return o.jsx(se,{scope:e.__scopeToggleGroup,type:"multiple",value:r,onItemActivate:l,onItemDeactivate:m,children:o.jsx(ne,{...u,ref:s})})});$.displayName=j;var[ze,qe]=te(j),ne=T.forwardRef((e,s)=>{const{__scopeToggleGroup:t,disabled:n=!1,rovingFocus:i=!0,orientation:u,dir:r,loop:a=!0,...l}=e,m=oe(t),x=z(r),f={role:"group",dir:x,...l};return o.jsx(ze,{scope:t,rovingFocus:i,disabled:n,children:i?o.jsx(Ue,{asChild:!0,...m,orientation:u,dir:x,loop:a,children:o.jsx(w.div,{...f,ref:s})}):o.jsx(w.div,{...f,ref:s})})}),G="ToggleGroupItem",ae=T.forwardRef((e,s)=>{const t=re(G,e.__scopeToggleGroup),n=qe(G,e.__scopeToggleGroup),i=oe(e.__scopeToggleGroup),u=t.value.includes(e.value),r=n.disabled||e.disabled,a={...e,pressed:u,disabled:r},l=T.useRef(null);return n.rovingFocus?o.jsx(Ve,{asChild:!0,...i,focusable:!r,active:u,ref:l,children:o.jsx(K,{...a,ref:s})}):o.jsx(K,{...a,ref:s})});ae.displayName=G;var K=T.forwardRef((e,s)=>{const{__scopeToggleGroup:t,value:n,...i}=e,u=re(G,t),r={role:"radio","aria-checked":e.pressed,"aria-pressed":void 0},a=u.type==="single"?r:void 0;return o.jsx(B,{...a,...i,ref:s,onPressedChange:l=>{l?u.onItemActivate(n):u.onItemDeactivate(n)}})}),ce=$,ie=ae;const ue=Ne("inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground"},size:{default:"h-9 px-2 min-w-9",sm:"h-8 px-1.5 min-w-8",lg:"h-10 px-2.5 min-w-10"}},defaultVariants:{variant:"default",size:"default"}}),P=c.forwardRef(({className:e,variant:s,size:t,...n},i)=>o.jsx(ee,{ref:i,className:M(ue({variant:s,size:t,className:e})),...n}));P.displayName=ee.displayName;const le=c.createContext({size:"default",variant:"default"}),de=c.forwardRef(({className:e,variant:s,size:t,children:n,...i},u)=>o.jsx(ce,{ref:u,className:M("flex items-center justify-center gap-1",e),...i,children:o.jsx(le.Provider,{value:{variant:s,size:t},children:n})}));de.displayName=ce.displayName;const me=c.forwardRef(({className:e,children:s,variant:t,size:n,...i},u)=>{const r=c.useContext(le);return o.jsx(ie,{ref:u,className:M(ue({variant:r.variant||t,size:r.size||n}),e),...i,children:s})});me.displayName=ie.displayName;const tt=()=>{const[e,s]=c.useState([]),[t,n]=c.useState([]),[i,u]=c.useState(!1),[r,a]=c.useState([]),[l,m]=c.useState(),[x,f]=c.useState(),[p,I]=c.useState(!1),[d,N]=c.useState(!0),[F,C]=c.useState(!0),[S,y]=c.useState(!0);c.useEffect(()=>{(async()=>{try{const b=await H("SELECT d.itemId, i.itemName FROM drops d JOIN items i ON d.itemId = i.itemId GROUP BY d.itemId ORDER BY d.itemId");let h=[];b.length>0&&(h=b.map(v=>({itemId:v.itemId,itemName:v.itemName}))),s(h)}catch(b){console.error("Error fetching toggle list:",b)}})()},[]),c.useEffect(()=>{if(e.length>0){const g=e.map((b,h)=>o.jsx(me,{value:b.itemId,className:"bg-background w-[200px]",children:b.itemName},`toggle-${h}`));m(o.jsx(de,{type:"multiple",variant:"outline",className:"flex flex-wrap md:justify-center sm:justify-center lg:justify-between",value:r,onValueChange:a,children:g}))}},[e,r]),c.useEffect(()=>{if(t.length>0){let g;if(p)g=t.map((b,h)=>o.jsx(T.Fragment,{children:o.jsx(Y,{battleInfo:b})},`battle-table-${h}`));else{const b=t.map((h,v)=>o.jsx(T.Fragment,{children:o.jsxs(Ce,{value:h.battleName,children:[o.jsx(Te,{className:"mt-2 text-base font-medium py-2 h-auto bg-background",children:h.battleName}),o.jsx(Fe,{className:"pt-1",children:o.jsx(Y,{battleInfo:h})})]})},`battle-table-${v}`));g=()=>o.jsx(Se,{type:"multiple",children:b})}f(g)}},[t,p]),c.useEffect(()=>{t.length>0||t.length===0&&i&&f(o.jsx("p",{children:"查無資料"}))},[t]);const L=async()=>{f([]),u(!0);try{if(r.length>0){let g="%",b="%";d||F?d&&F?g="%":d?g="N":g="Y":b="Y";const h=await H(`SELECT a.battleName, a.consumes, a.rank, GROUP_CONCAT(CASE WHEN d.isFirst = 'Y' THEN CONCAT(d.itemId, 'x', d.count, 'x', i.itemRarity, 'x', IFNULL(i.route, '無'), 'x', IFNULL(i.itemPicFolder, '無'), 'x', i.itemName, 'x', i.itemDesc, 'x', IFNULL(i.itemRmk, '無')) END) AS isFirstItems, GROUP_CONCAT(CASE WHEN d.isBonus = 'N' THEN CONCAT(d.itemId, 'x', d.count, 'x', i.itemRarity, 'x', IFNULL(i.route, '無'), 'x', IFNULL(i.itemPicFolder, '無'), 'x', i.itemName, 'x', i.itemDesc, 'x', IFNULL(i.itemRmk, '無')) END) AS nonBonusItems, GROUP_CONCAT(CASE WHEN d.isBonus = 'Y' THEN CONCAT(d.itemId, 'x', d.count, 'x', i.itemRarity, 'x', IFNULL(i.route, '無'), 'x', IFNULL(i.itemPicFolder, '無'), 'x', i.itemName, 'x', i.itemDesc, 'x', IFNULL(i.itemRmk, '無')) END) AS bonusItems FROM area a LEFT JOIN drops d ON a.chapterId = d.chapterId AND a.containLevel = d.containLevel LEFT JOIN items i ON d.itemId = i.itemId WHERE a.battleName IN ( SELECT DISTINCT a.battleName FROM area a LEFT JOIN drops d ON a.chapterId = d.chapterId AND a.containLevel = d.containLevel WHERE d.itemId IN (${r.map(()=>"?").join(", ")}) AND d.isBonus like '${g}' AND d.isFirst like '${b}' ) GROUP BY a.battleName, a.consumes, a.rank ORDER BY a.battleName, a.containLevel`,[...r]);n(h)}else f(()=>o.jsx("p",{children:"請至少選擇一項"}))}catch(g){console.error("查詢失敗:",g)}};return o.jsxs("div",{className:"w-4/5",children:[o.jsx("p",{className:"mb-4 text-3xl",children:"關卡資訊-掉落搜尋"}),o.jsxs("div",{className:"flex flex-wrap lg:space-x-2 md:justify-center sm:justify-center lg:justify-start",children:[o.jsx(P,{value:"first",className:"data-[state=on]:bg-[#008866] data-[state=off]:bg-background w-[200px] mb-2",onPressedChange:g=>y(g),pressed:S,children:"首次掉落"}),o.jsx(P,{value:"base",className:"data-[state=on]:bg-[#008866] data-[state=off]:bg-background w-[200px] mb-2",onPressedChange:g=>N(g),pressed:d,children:"固定掉落"}),o.jsx(P,{value:"bonus",className:"data-[state=on]:bg-[#008866] data-[state=off]:bg-background w-[200px] mb-2",onPressedChange:g=>C(g),pressed:F,children:"機率掉落"})]}),l&&l,o.jsxs("div",{children:[o.jsx(V,{onClick:()=>a([]),variant:"ghost",className:"w-full mt-2 bg-[#33FFFF] hover:bg-[#3DFFFF]",children:"清空"}),o.jsx(V,{onClick:L,variant:"ghost",className:"w-full mt-2 bg-[#999999] hover:bg-[#b3b3b3]",children:"查詢"})]}),o.jsx("div",{className:"flex flex-col mt-4 max-w-4/5 justify-center bg-background rounded-md",children:x&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"flex space-x-2 m-4",children:[o.jsx(Ee,{className:"p-0",onCheckedChange:g=>I(g)}),o.jsx(Re,{className:"self-center",children:"詳細檢視"})]}),x]})})]})};export{tt as default};
