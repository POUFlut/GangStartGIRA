import{r as c,j as o,g as ve,u as be,q as z,d as _,o as he,P,e as S,n as Ie,R as F,a as B,v as Ne,A as Ce,w as Te,x as Fe,B as V,t as H,y as Ee}from"./index-BQ2CVA4a.js";import{B as Y,S as Re}from"./switch-B6Y1Ten8.js";import{L as Se}from"./popover-Dkfj8yR4.js";import"./index-C5WWort5.js";function je(e,s=[]){let t=[];function r(u,n){const a=c.createContext(n),l=t.length;t=[...t,n];function m(f){const{scope:p,children:I,...d}=f,N=(p==null?void 0:p[e][l])||a,E=c.useMemo(()=>d,Object.values(d));return o.jsx(N.Provider,{value:E,children:I})}function x(f,p){const I=(p==null?void 0:p[e][l])||a,d=c.useContext(I);if(d)return d;if(n!==void 0)return n;throw new Error(`\`${f}\` must be used within \`${u}\``)}return m.displayName=u+"Provider",[m,x]}const i=()=>{const u=t.map(n=>c.createContext(n));return function(a){const l=(a==null?void 0:a[e])||u;return c.useMemo(()=>({[`__scope${e}`]:{...a,[e]:l}}),[a,l])}};return i.scopeName=e,[r,ye(i,...s)]}function ye(...e){const s=e[0];if(e.length===1)return s;const t=()=>{const r=e.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(u){const n=r.reduce((a,{useScope:l,scopeName:m})=>{const f=l(u)[`__scope${m}`];return{...a,...f}},{});return c.useMemo(()=>({[`__scope${s.scopeName}`]:n}),[n])}};return t.scopeName=s.scopeName,t}function Pe(e,s=[]){let t=[];function r(u,n){const a=c.createContext(n),l=t.length;t=[...t,n];function m(f){const{scope:p,children:I,...d}=f,N=(p==null?void 0:p[e][l])||a,E=c.useMemo(()=>d,Object.values(d));return o.jsx(N.Provider,{value:E,children:I})}function x(f,p){const I=(p==null?void 0:p[e][l])||a,d=c.useContext(I);if(d)return d;if(n!==void 0)return n;throw new Error(`\`${f}\` must be used within \`${u}\``)}return m.displayName=u+"Provider",[m,x]}const i=()=>{const u=t.map(n=>c.createContext(n));return function(a){const l=(a==null?void 0:a[e])||u;return c.useMemo(()=>({[`__scope${e}`]:{...a,[e]:l}}),[a,l])}};return i.scopeName=e,[r,we(i,...s)]}function we(...e){const s=e[0];if(e.length===1)return s;const t=()=>{const r=e.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(u){const n=r.reduce((a,{useScope:l,scopeName:m})=>{const f=l(u)[`__scope${m}`];return{...a,...f}},{});return c.useMemo(()=>({[`__scope${s.scopeName}`]:n}),[n])}};return t.scopeName=s.scopeName,t}var D="rovingFocusGroup.onEntryFocus",Ge={bubbles:!1,cancelable:!0},A="RovingFocusGroup",[k,q,_e]=ve(A),[Ae,W]=Pe(A,[_e]),[Oe,Le]=Ae(A),J=c.forwardRef((e,s)=>o.jsx(k.Provider,{scope:e.__scopeRovingFocusGroup,children:o.jsx(k.Slot,{scope:e.__scopeRovingFocusGroup,children:o.jsx(De,{...e,ref:s})})}));J.displayName=A;var De=c.forwardRef((e,s)=>{const{__scopeRovingFocusGroup:t,orientation:r,loop:i=!1,dir:u,currentTabStopId:n,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:l,onEntryFocus:m,preventScrollOnEntryFocus:x=!1,...f}=e,p=c.useRef(null),I=be(s,p),d=z(u),[N=null,E]=_({prop:n,defaultProp:a,onChange:l}),[T,C]=c.useState(!1),y=he(m),O=q(t),g=c.useRef(!1),[b,h]=c.useState(0);return c.useEffect(()=>{const v=p.current;if(v)return v.addEventListener(D,y),()=>v.removeEventListener(D,y)},[y]),o.jsx(Oe,{scope:t,orientation:r,dir:d,loop:i,currentTabStopId:N,onItemFocus:c.useCallback(v=>E(v),[E]),onItemShiftTab:c.useCallback(()=>C(!0),[]),onFocusableItemAdd:c.useCallback(()=>h(v=>v+1),[]),onFocusableItemRemove:c.useCallback(()=>h(v=>v-1),[]),children:o.jsx(P.div,{tabIndex:T||b===0?-1:0,"data-orientation":r,...f,ref:I,style:{outline:"none",...e.style},onMouseDown:S(e.onMouseDown,()=>{g.current=!0}),onFocus:S(e.onFocus,v=>{const fe=!g.current;if(v.target===v.currentTarget&&fe&&!T){const $=new CustomEvent(D,Ge);if(v.currentTarget.dispatchEvent($),!$.defaultPrevented){const L=O().filter(R=>R.focusable),ge=L.find(R=>R.active),pe=L.find(R=>R.id===N),xe=[ge,pe,...L].filter(Boolean).map(R=>R.ref.current);Z(xe,x)}}g.current=!1}),onBlur:S(e.onBlur,()=>C(!1))})})}),Q="RovingFocusGroupItem",X=c.forwardRef((e,s)=>{const{__scopeRovingFocusGroup:t,focusable:r=!0,active:i=!1,tabStopId:u,...n}=e,a=Ie(),l=u||a,m=Le(Q,t),x=m.currentTabStopId===l,f=q(t),{onFocusableItemAdd:p,onFocusableItemRemove:I}=m;return c.useEffect(()=>{if(r)return p(),()=>I()},[r,p,I]),o.jsx(k.ItemSlot,{scope:t,id:l,focusable:r,active:i,children:o.jsx(P.span,{tabIndex:x?0:-1,"data-orientation":m.orientation,...n,ref:s,onMouseDown:S(e.onMouseDown,d=>{r?m.onItemFocus(l):d.preventDefault()}),onFocus:S(e.onFocus,()=>m.onItemFocus(l)),onKeyDown:S(e.onKeyDown,d=>{if(d.key==="Tab"&&d.shiftKey){m.onItemShiftTab();return}if(d.target!==d.currentTarget)return;const N=Me(d,m.orientation,m.dir);if(N!==void 0){if(d.metaKey||d.ctrlKey||d.altKey||d.shiftKey)return;d.preventDefault();let T=f().filter(C=>C.focusable).map(C=>C.ref.current);if(N==="last")T.reverse();else if(N==="prev"||N==="next"){N==="prev"&&T.reverse();const C=T.indexOf(d.currentTarget);T=m.loop?Ue(T,C+1):T.slice(C+1)}setTimeout(()=>Z(T))}})})})});X.displayName=Q;var ke={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Be(e,s){return s!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function Me(e,s,t){const r=Be(e.key,t);if(!(s==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(s==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return ke[r]}function Z(e,s=!1){const t=document.activeElement;for(const r of e)if(r===t||(r.focus({preventScroll:s}),document.activeElement!==t))return}function Ue(e,s){return e.map((t,r)=>e[(s+r)%e.length])}var $e=J,Ve=X,He="Toggle",M=c.forwardRef((e,s)=>{const{pressed:t,defaultPressed:r=!1,onPressedChange:i,...u}=e,[n=!1,a]=_({prop:t,onChange:i,defaultProp:r});return o.jsx(P.button,{type:"button","aria-pressed":n,"data-state":n?"on":"off","data-disabled":e.disabled?"":void 0,...u,ref:s,onClick:S(e.onClick,()=>{e.disabled||a(!n)})})});M.displayName=He;var ee=M,j="ToggleGroup",[te,et]=je(j,[W]),oe=W(),U=F.forwardRef((e,s)=>{const{type:t,...r}=e;if(t==="single"){const i=r;return o.jsx(Ye,{...i,ref:s})}if(t==="multiple"){const i=r;return o.jsx(Ke,{...i,ref:s})}throw new Error(`Missing prop \`type\` expected on \`${j}\``)});U.displayName=j;var[se,ne]=te(j),Ye=F.forwardRef((e,s)=>{const{value:t,defaultValue:r,onValueChange:i=()=>{},...u}=e,[n,a]=_({prop:t,defaultProp:r,onChange:i});return o.jsx(se,{scope:e.__scopeToggleGroup,type:"single",value:n?[n]:[],onItemActivate:a,onItemDeactivate:F.useCallback(()=>a(""),[a]),children:o.jsx(re,{...u,ref:s})})}),Ke=F.forwardRef((e,s)=>{const{value:t,defaultValue:r,onValueChange:i=()=>{},...u}=e,[n=[],a]=_({prop:t,defaultProp:r,onChange:i}),l=F.useCallback(x=>a((f=[])=>[...f,x]),[a]),m=F.useCallback(x=>a((f=[])=>f.filter(p=>p!==x)),[a]);return o.jsx(se,{scope:e.__scopeToggleGroup,type:"multiple",value:n,onItemActivate:l,onItemDeactivate:m,children:o.jsx(re,{...u,ref:s})})});U.displayName=j;var[ze,qe]=te(j),re=F.forwardRef((e,s)=>{const{__scopeToggleGroup:t,disabled:r=!1,rovingFocus:i=!0,orientation:u,dir:n,loop:a=!0,...l}=e,m=oe(t),x=z(n),f={role:"group",dir:x,...l};return o.jsx(ze,{scope:t,rovingFocus:i,disabled:r,children:i?o.jsx($e,{asChild:!0,...m,orientation:u,dir:x,loop:a,children:o.jsx(P.div,{...f,ref:s})}):o.jsx(P.div,{...f,ref:s})})}),G="ToggleGroupItem",ae=F.forwardRef((e,s)=>{const t=ne(G,e.__scopeToggleGroup),r=qe(G,e.__scopeToggleGroup),i=oe(e.__scopeToggleGroup),u=t.value.includes(e.value),n=r.disabled||e.disabled,a={...e,pressed:u,disabled:n},l=F.useRef(null);return r.rovingFocus?o.jsx(Ve,{asChild:!0,...i,focusable:!n,active:u,ref:l,children:o.jsx(K,{...a,ref:s})}):o.jsx(K,{...a,ref:s})});ae.displayName=G;var K=F.forwardRef((e,s)=>{const{__scopeToggleGroup:t,value:r,...i}=e,u=ne(G,t),n={role:"radio","aria-checked":e.pressed,"aria-pressed":void 0},a=u.type==="single"?n:void 0;return o.jsx(M,{...a,...i,ref:s,onPressedChange:l=>{l?u.onItemActivate(r):u.onItemDeactivate(r)}})}),ce=U,ie=ae;const ue=Ne("inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground"},size:{default:"h-9 px-2 min-w-9",sm:"h-8 px-1.5 min-w-8",lg:"h-10 px-2.5 min-w-10"}},defaultVariants:{variant:"default",size:"default"}}),w=c.forwardRef(({className:e,variant:s,size:t,...r},i)=>o.jsx(ee,{ref:i,className:B(ue({variant:s,size:t,className:e})),...r}));w.displayName=ee.displayName;const le=c.createContext({size:"default",variant:"default"}),de=c.forwardRef(({className:e,variant:s,size:t,children:r,...i},u)=>o.jsx(ce,{ref:u,className:B("flex items-center justify-center gap-1",e),...i,children:o.jsx(le.Provider,{value:{variant:s,size:t},children:r})}));de.displayName=ce.displayName;const me=c.forwardRef(({className:e,children:s,variant:t,size:r,...i},u)=>{const n=c.useContext(le);return o.jsx(ie,{ref:u,className:B(ue({variant:n.variant||t,size:n.size||r}),e),...i,children:s})});me.displayName=ie.displayName;const tt=()=>{const[e,s]=c.useState([]),[t,r]=c.useState([]),[i,u]=c.useState(!1),[n,a]=c.useState([]),[l,m]=c.useState(),[x,f]=c.useState(),[p,I]=c.useState(!1),[d,N]=c.useState(!0),[E,T]=c.useState(!0),[C,y]=c.useState(!0);c.useEffect(()=>{(async()=>{try{const b=await H("SELECT d.itemId, i.itemName FROM drops d JOIN items i ON d.itemId = i.itemId WHERE d.isFirst <> 'Y' GROUP BY d.itemId ORDER BY d.itemId");let h=[];b.length>0&&(h=b.map(v=>({itemId:v.itemId,itemName:v.itemName}))),s(h)}catch(b){console.error("Error fetching toggle list:",b)}})()},[]),c.useEffect(()=>{if(e.length>0){const g=e.map((b,h)=>o.jsx(me,{value:b.itemId,className:"bg-background w-[200px] data-[state=on]:bg-[#00DDAA] data-[state=off]:bg-background",children:b.itemName},`toggle-${h}`));m(o.jsx(de,{type:"multiple",variant:"outline",className:"flex flex-wrap md:justify-center sm:justify-center lg:justify-between",value:n,onValueChange:a,children:g}))}},[e,n]),c.useEffect(()=>{if(t.length>0){let g;if(p)g=t.map((b,h)=>o.jsx(F.Fragment,{children:o.jsx(Y,{battleInfo:b})},`battle-table-${h}`));else{const b=t.map((h,v)=>o.jsx(F.Fragment,{children:o.jsxs(Ce,{value:h.battleName,children:[o.jsx(Te,{className:"mt-2 text-base font-medium py-2 h-auto bg-background",children:h.battleName}),o.jsx(Fe,{className:"pt-1",children:o.jsx(Y,{battleInfo:h})})]})},`battle-table-${v}`));g=()=>o.jsx(Ee,{type:"multiple",children:b})}f(g)}},[t,p]),c.useEffect(()=>{t.length>0||t.length===0&&i&&f(o.jsx("p",{children:"查無資料"}))},[t]);const O=async()=>{f([]),u(!0);try{if(n.length>0){let g="%",b="%";(d||E)&&(d&&E?g="%":d?g="N":g="Y");const h=await H(`SELECT a.battleName, a.consumes, a.rank, GROUP_CONCAT(CASE WHEN d.isFirst = 'Y' THEN CONCAT(d.itemId, 'x', d.count, 'x', i.itemRarity, 'x', IFNULL(i.route, '無'), 'x', IFNULL(i.itemPicFolder, '無'), 'x', i.itemName, 'x', i.itemDesc, 'x', IFNULL(i.itemRmk, '無')) END) AS isFirstItems, GROUP_CONCAT(CASE WHEN d.isBonus = 'N' THEN CONCAT(d.itemId, 'x', d.count, 'x', i.itemRarity, 'x', IFNULL(i.route, '無'), 'x', IFNULL(i.itemPicFolder, '無'), 'x', i.itemName, 'x', i.itemDesc, 'x', IFNULL(i.itemRmk, '無')) END) AS nonBonusItems, GROUP_CONCAT(CASE WHEN d.isBonus = 'Y' THEN CONCAT(d.itemId, 'x', d.count, 'x', i.itemRarity, 'x', IFNULL(i.route, '無'), 'x', IFNULL(i.itemPicFolder, '無'), 'x', i.itemName, 'x', i.itemDesc, 'x', IFNULL(i.itemRmk, '無')) END) AS bonusItems FROM area a LEFT JOIN drops d ON a.chapterId = d.chapterId AND a.containLevel = d.containLevel LEFT JOIN items i ON d.itemId = i.itemId WHERE a.battleName IN ( SELECT DISTINCT a.battleName FROM area a LEFT JOIN drops d ON a.chapterId = d.chapterId AND a.containLevel = d.containLevel WHERE d.itemId IN (${n.map(()=>"?").join(", ")}) AND d.isBonus like '${g}' AND d.isFirst like '${b}' `+(C?`GROUP BY a.battleName HAVING COUNT(DISTINCT d.itemId) = ${n.length} `:"GROUP BY a.battleName ")+") GROUP BY a.battleName, a.consumes, a.rank ORDER BY a.battleName, a.containLevel",[...n]);r(h)}else f(()=>o.jsx("p",{children:"請至少選擇一項"}))}catch(g){console.error("查詢失敗:",g)}};return o.jsxs("div",{className:"w-4/5",children:[o.jsx("p",{className:"mb-4 text-3xl",children:"關卡資訊-掉落搜尋器"}),o.jsxs("div",{className:"flex flex-wrap mb-2 border-b border-b-[#666666] justify-center lg:space-x-2 md:justify-center sm:justify-center lg:justify-start",children:[o.jsx(w,{value:"base",className:"data-[state=on]:bg-[#008866] data-[state=off]:bg-background w-[200px] mb-2",onPressedChange:g=>N(g),pressed:d,children:"固定掉落"}),o.jsx(w,{value:"bonus",className:"data-[state=on]:bg-[#008866] data-[state=off]:bg-background w-[200px] mb-2",onPressedChange:g=>T(g),pressed:E,children:"機率掉落"}),o.jsx(w,{value:"andOp",className:"data-[state=on]:bg-[#FFEE99] data-[state=off]:bg-[#FFC8B4] w-[200px] mb-2",onPressedChange:g=>y(g),pressed:C,children:C?"選項同時掉落":"選項則一掉落"})]}),l&&l,o.jsxs("div",{children:[o.jsx(V,{onClick:()=>a([]),variant:"ghost",className:"w-full mt-2 bg-[#33FFFF] hover:bg-[#3DFFFF]",children:"清空"}),o.jsx(V,{onClick:O,variant:"ghost",className:"w-full mt-2 bg-[#999999] hover:bg-[#b3b3b3]",children:"查詢"})]}),o.jsx("div",{className:"flex flex-col mt-4 max-w-4/5 justify-center bg-background rounded-md",children:x&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"flex space-x-2 m-4",children:[o.jsx(Re,{className:"p-0",onCheckedChange:g=>I(g)}),o.jsx(Se,{className:"self-center",children:"詳細檢視"})]}),x]})})]})};export{tt as default};
